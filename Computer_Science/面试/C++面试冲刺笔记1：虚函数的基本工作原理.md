# C++é¢è¯•å†²åˆºç¬”è®°1ï¼šè™šå‡½æ•°çš„åŸºæœ¬å·¥ä½œåŸç†

## å‰è¨€

â€‹	ç¬”è€…æœ€è¿‘å¼€å§‹æŠ•ç®€å†ï¼Œå‡ºäºåº”å¯¹ä¹‹åå¿«é€Ÿçš„é¢è¯•æµç¨‹éœ€æ±‚ï¼Œè¿™é‡Œå‡†å¤‡çš„æ˜¯å°†å¸¸è§çš„C++å…«è‚¡æ–‡è¿›è¡Œæ€»ç»“ï¼Œä»è€Œæ–¹ä¾¿è‡ªå·±è¿›è¡Œå­¦ä¹ ï¼Œæ£€æŸ¥å’Œè¯„ä¼°ã€‚

## ä»€ä¹ˆæ˜¯è™šå‡½æ•°

â€‹	è™šå‡½æ•°ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯å‡½æ•°ï¼Œä¸ºä»€ä¹ˆæ˜¯è™šçš„å‘¢ï¼Ÿè™šå‡½æ•°æœ¬è´¨ä¸Šæ˜¯ç”± `virtual` ä¿®é¥°çš„æˆå‘˜å‡½æ•°ï¼Œä½†â€œè™šâ€çš„çœŸæ­£å«ä¹‰æŒ‡çš„æ˜¯ï¼šå®ƒçš„è°ƒç”¨è¡Œä¸ºå¹¶éåœ¨ç¼–è¯‘é˜¶æ®µå†³å®šï¼Œè€Œæ˜¯åœ¨è¿è¡Œé˜¶æ®µé€šè¿‡åŠ¨æ€ç»‘å®šæœºåˆ¶å†³å®šã€‚ä¸¾ä¸€ä¸ªä¾‹å­æ„Ÿå—ä¸€ä¸‹ï¼š

```cpp
class BaseClass {
public:
  	virtual void aVirtualFunction() = 0; // è¿™æ˜¯ä¸€ä¸ªæœ€æç«¯çš„çº¯è™šå‡½æ•°  
};

class DerivedClass : public BaseClass {
public:
    void aVirtualFunction() override; // è¿™æ˜¯å­ç±»çš„ä¸€ä¸ªå®ç°
};
```

â€‹	å¦‚æœä½ ç†Ÿæ‚‰ï¼Œä½ å°±ä¼šè¯´ï¼šå¾ˆç®€å•ï¼Œå½“æˆ‘ä»¬å†™ä¸Šä»£ç ï¼š

```cpp
BaseClass* pSon = new DerivedClass();
pSon->aVirtualFunction();
```

â€‹	çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šé«˜å…´çš„å‘ç°ï¼Œå°½ç®¡æˆ‘ä»¬åœ¨ä¹¦å†™çš„æ—¶å€™å†™çš„æ˜¯BaseClass*ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œç”±äºæˆ‘ä»¬çš„èµ‹å€¼å¯¹è±¡æ˜¯BaseClassçš„æ´¾ç”Ÿç±»DerivedClassï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒaVirtualFunctionè¢«ç§ç§çš„æ›¿æ¢æˆäº†å­ç±»çš„å®ç°è€Œä¸æ˜¯çˆ¶ç±»çš„å®ç°ã€‚**è¿™å°±æ˜¯ä¸€ç§è¿è¡Œæ—¶çš„å¤šæ€ï¼**å¤§ç±»ä¸­çš„å­ç±»è¡Œä¸ºå¯ä»¥è¢«å…±åŒè¡¨è¾¾ä¸ºä¸€ä¸ªæŠ½è±¡çš„è¡Œä¸ºï¼Œè€Œå­ç±»åˆ™å„è‡ªä¸ºæ”¿ï¼Œå…·è±¡åŒ–è¿™ä¸ªæŠ½è±¡çš„çˆ¶ç±»è¡Œä¸ºï¼ˆæˆ–è€…æ˜¯è¦†ç›–çˆ¶ç±»çš„è¡Œä¸ºï¼Œè¿™å°±æ˜¯ç±»çš„è¦†ç›–äº†ï¼Œæˆ‘ä»¬åé¢è®¨è®ºç±»çš„æ—¶å€™æ…¢æ…¢èŠï¼‰ã€‚

## è™šå‡½æ•°çš„å®ç°æœ¬è´¨

â€‹	æˆ‘ä»¬ç°åœ¨èŠä¸€èŠè™šå‡½æ•°çš„è¿ä½œæœ¬è´¨æ˜¯å¦‚ä½•æ”¯æŒçš„ã€‚å¾ˆç®€å•ï¼Œå†™è¿‡åµŒå…¥å¼Cæ¯”è¾ƒå¤§å‹é¡¹ç›®çš„æœ‹å‹éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬ç»å¸¸æå‡½æ•°å›è°ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™åŠ¨æ€çš„è·³è½¬é“ç»™å®šçš„åœ°å€æ‰§è¡Œä»£ç ã€‚åœ¨C++ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°â€”â€”ä¸Šè¿°çš„è¿™äº›æœ¬è´¨ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ç±»ä¸­çš„ä¸€ä¸ªåŠ¨æ€çš„å­˜å‚¨ç€å‡½æ•°æŒ‡é’ˆçš„æˆå‘˜å˜é‡ï¼Œå‘ç”Ÿç»§æ‰¿çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æŠŠå­ç±»çš„æŒ‡é’ˆèµ‹å€¼ç»™æˆ‘ä»¬çš„å¯¹è±¡ä¸Šï¼Œè¿™æ ·ï¼Œå‘ç”Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„å‡½æ•°ã€‚å¾ˆå¥½ï¼å®é™…ä¸Šå¤§è‡´çš„ç¡®å¦‚æ­¤ï¼Œæˆ‘ä»¬æŠŠè¿™äº›æ½œåœ¨çš„è™šå‡½æ•°æ’åˆ—æˆä¸€å¼ è¡¨æ ¼ã€‚ä¹Ÿå°±æ˜¯ç»å…¸çš„è™šå‡½æ•°è¡¨ã€‚è™šå‡½æ•°è¡¨æ˜¯ç”¨ä¸€ä¸ªè™šå‡½æ•°è¡¨æŒ‡é’ˆæŒ‡å‘çš„ã€‚æ‰€ä»¥è¯´ï¼Œ**æŒ‡å‘è™šå‡½æ•°è¡¨æˆå‘˜çš„å¤§å°å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„å¤§å°**ï¼Œè¿™æ˜¯æ¯‹åº¸ç½®ç–‘çš„ã€‚**è¿™å°±æ˜¯ä½ è°ƒè¯•ä¸€ä¸ªå¸¦æœ‰è™šå‡½æ•°çš„ç±»çš„æ—¶å€™ï¼Œä½ çœ‹åˆ°è°ƒè¯•æ ä¸­çš„`_vptr`æˆ–è€…`_vtable`**å¯¹è±¡äº†ã€‚

> å…è´£å£°æ˜ï¼š
>
> - `_vptr` æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„ï¼Œåç§°å’Œå¸ƒå±€æ˜¯å®ç°ç›¸å…³çš„ï¼ˆå¦‚ MSVC å’Œ GCC ä¸ä¸€æ ·ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒçš„ç¼–è¯‘å™¨å¯¹æ­¤çš„å®ç°ä¸ä¸€è‡´ï¼Œæ‰€ä»¥åˆ«ä¹±æHackæŠŠä»£ç çš„å¯ç§»æ¤æ€§æä¸¢äº†
> - ä¸æ˜¯æ ‡å‡†å®šä¹‰çš„ï¼Œå› æ­¤ä¾èµ–å®ƒåš portable ç¼–ç¨‹æ˜¯ä¸å¯å–çš„ï¼Œä½†äº†è§£å®ƒå¯¹ç†è§£åŸç†å¾ˆé‡è¦ã€‚

## ä¸€äº›å…¶ä»–é‡è¦çš„äº‹æƒ…

- æ´¾ç”Ÿç±»ä¸­é‡å†™æ—¶ï¼Œ**å¯ä»¥çœç•¥ `virtual`**ï¼Œè™šæ€§è‡ªåŠ¨ç»§æ‰¿ã€‚

- å¯ä»¥ç”¨ `override` å¼ºåˆ¶ç¼–è¯‘å™¨æ£€æŸ¥å‡½æ•°ç­¾åæ˜¯å¦åŒ¹é…ï¼Œé¿å…æ‹¼å†™æˆ–å‚æ•°é”™è¯¯ 

- **çº¯è™šå‡½æ•°**ï¼ˆ`=0`ï¼‰è¡¨ç¤ºâ€œå­ç±»å¿…é¡»é‡å†™â€ï¼Œå®¹è®¸å®šä¹‰æŠ½è±¡ç±»ï¼Œä¹Ÿå°±æ˜¯æ— æ³•å®ä¾‹åŒ–çš„æ¥å£ ã€‚è¿™ä¸ªå°trickå¯ä»¥ç”¨åœ¨åº“è®¾è®¡ä¸­ï¼Œå¼ºè¿«å®¢æˆ·ç¨‹åºå‘˜é‡å†™çˆ¶ç±»çš„ä»£ç 

- **è™šææ„å‡½æ•°**ç”¨æ¥ç¡®ä¿é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤å­ç±»å¯¹è±¡æ—¶ï¼Œææ„é“¾èƒ½æ­£ç¡®è§¦å‘ã€‚æ‰€ä»¥ï¼Œä»»ä½•å¸¦æœ‰è™šå‡½æ•°çš„ç±»ï¼Œéƒ½æœ€å¥½å°†è‡ªå·±çš„ææ„å‡½æ•°å†™ä¸Šå¤§å¤§çš„`virtual`ï¼Œå¦åˆ™ä¼šç¿»è½¦ã€‚

  ```cpp
  struct A {
      ~A() { std::cout << "Aææ„\n"; }
  };
  struct B : A {
      ~B() { std::cout << "Bææ„\n"; }
  };
  
  A* p = new B();
  delete p; // åªä¼šè°ƒç”¨Açš„ææ„ï¼
  ```

  è¿™ä¸ªæ—¶å€™ä½ éœ€è¦åšçš„æ˜¯ï¼š

  ```cpp
  struct A {
      virtual ~A() { std::cout << "Aææ„\n"; }
  };
  ```

- é™æ€å‡½æ•°ä¸èƒ½æ˜¯è™šå‡½æ•°ï¼šå®ƒä¸å±äºå®ä¾‹ï¼Œæ²¡ `this` æŒ‡é’ˆï¼Œæ— æ³•å‚ä¸åŠ¨æ€ç»‘å®š

# åˆ°è¿™é‡Œå°±ç»“æŸï¼ŸNo No No

â€‹	é‚£å¯å¤ªæ²¡æ„æ€äº†å…„å¼Ÿä»¬ï¼Œå¤§ä¼™éƒ½çŸ¥é“æˆ‘è¿™ä¸ªäººçš„æ€§å­ï¼Œå†™ç€ç‚¹æ˜¯æ²¡æœ‰å•¥å€¼å¾—è¯´çš„ï¼Œå¦åˆ™å°±æˆäº†åšå®¢çŒæ°´äº†ã€‚æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„è¯é¢˜ã€‚

## å¤šé‡ç»§æ‰¿ä¸‹çš„è™šå‡½æ•°è¡¨ç»“æ„ï¼ˆä¸»æ¬¡ vtableï¼‰

â€‹	æˆ‘ä»¬çŸ¥é“ï¼ŒC++æ˜¯ä¸€ä¸ªå…è®¸å¤šé‡ç»§æ‰¿çš„è¯­è¨€ï¼Œè¯·çœ‹ä¸‹å›¾ï¼š

```c++
class HolyShitComplexClass : 	public BaseA, // is BaseA
							  public BaseB, // is BaseB
							  public BaseC, // is Also BaseC
{
    ...
};
```

â€‹	è¿™ä¸ªæ‰€è°“çš„HolyShitComplexClassæ˜¯ä¸‰ä¸ªç±»çš„å­é›†ï¼Œæˆ‘ä»¬è¿™ä¸ªæ—¶å€™ä¼šé—®ï¼Œæ¬¸ï¼è¿™ä¹ˆå¤šçš„çˆ¶ç±»ï¼Œæˆ‘ä»¬çš„è™šå‡½æ•°è¡¨æ€ä¹ˆæ’åˆ—å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è¿™æ ·çš„ï¼ŒæŒ‰ç…§æˆ‘ä»¬ç»§æ‰¿çš„é¡ºåºï¼Œä¾æ¬¡æ’æ”¾æˆ‘ä»¬çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å¤šé‡ç»§æ‰¿ä¸­ï¼Œæ¯ä¸ªåŸºç±»å­å¯¹è±¡é€šå¸¸éƒ½æœ‰ç‹¬ç«‹çš„ `vptr` å’Œå¯¹åº”çš„ vtableï¼ˆä¸»è¡¨ä¸æ¬¡è¡¨ï¼‰ï¼Œä½¿å¾—å„ç»§æ‰¿è·¯å¾„å¯ç‹¬ç«‹åŠ¨æ€ç»‘å®š

```
[vptr_A][A_fields][vptr_B][B_fields][vptr_C][C_fields][Derived_fields]
```

â€‹	ä½ çœ‹ï¼Œè¿™æ ·æ’åˆ—çš„ï¼Œæˆ‘è¦æ˜¯é‡å†™äº†Aä¸­çš„ä¸€ä¸ªè™šå‡½æ•°çš„è¡Œä¸ºï¼Œå’±ä»¬å°±æ”¹Aå‡½æ•°è¡¨ä¸­å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆæŒ‡å‘ï¼Œå…¶ä»–çš„å¦‚æ³•ç‚®åˆ¶ï¼

## **è™šå‡½æ•°ä¸éè™šå‡½æ•°æ··åˆæ—¶çš„å†…å­˜å¸ƒå±€**

â€‹	æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€æ˜¯ç±»ä¸­åŒæ—¶å«æœ‰è™šå‡½æ•°å’Œéè™šæ•°æ®æˆå‘˜ï¼Œç¬”è€…çš„CCIMXDesktopé¡¹ç›®ä¸­å°±æœ‰å¤§é‡çš„è¿™æ ·çš„ä¾‹å­ï¼š

```cpp
#ifndef APPCARDWIDGET_H
#define APPCARDWIDGET_H

#include <QWidget>

class DesktopToast;
class QLabel;
namespace Ui {
class AppCardWidget;
}

/**
 * @brief AppCardWidget is a lightweight widget used to post messages to a DesktopToast.
 *
 * This is an abstract base class representing an application card UI component.
 * It is responsible for handling pre-launch work and posting messages via toast notifications.
 */
class AppCardWidget : public QWidget {
    Q_OBJECT

public:
    Q_DISABLE_COPY(AppCardWidget);
    AppCardWidget() = delete;

    /**
     * @brief Constructs an AppCardWidget.
     * @param toast Pointer to the DesktopToast object used to show messages.
     * @param parent Optional parent widget.
     */
    explicit AppCardWidget(DesktopToast* toast, QWidget* parent = nullptr);
    ~AppCardWidget();

    /**
     * @brief Set the current icon for the app card.
     *
     * This function allows derived classes to customize the app card icon
     * by providing a QPixmap.
     *
     * @param icons The pixmap to be used as the icon.
     */
    virtual void setCurrentIcon(const QPixmap& icons);

    /**
     * @brief Abstract method to invoke pre-launch operations.
     *
     * Derived classes should implement this to perform necessary
     * preparations before the system starts or the app card becomes active.
     */
    virtual void invoke_preLaunch_work() = 0;
    /**
     * @brief operate_comment_label
     */
    virtual void operate_comment_label() = 0;

    /**
     * @brief invoke_textlabel_stylefresh
     */
    void invoke_textlabel_stylefresh();

protected:
    /**
     * @brief Abstract method to post messages to the bound DesktopToast.
     *
     * Derived classes implement this to send notifications or status updates
     * through the toast system.
     */
    virtual void postAppCardWidget() = 0;

    /**
     * @brief setHelperFunction: plainly set the text for shown
     * @param what
     */
    virtual void setHelperFunction(const QString& what);

    virtual void setupSelfTextLabelStyle(QLabel* selfTextLabel) = 0;

    DesktopToast* binding_toast; ///< Pointer to the toast widget used for posting messages.
    Ui::AppCardWidget* ui; ///< UI object generated from the Qt Designer form.

public:
    /**
     * @brief Event filter to handle user interaction events.
     * @param watched The QObject being watched.
     * @param event The event being filtered.
     * @return true if the event was handled, otherwise false.
     */
    bool eventFilter(QObject* watched, QEvent* event) override;
};
#endif // APPCARDWIDGET_H
```

â€‹	ä½ çœ‹ï¼Œè¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬å°±æ··åˆäº†è™šå‡½æ•°å’Œéè™šå‡½æ•°ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬çš„ç¼–è¯‘å™¨æœ‰æ²¡æœ‰æ¯”è¾ƒå…·ä½“çš„æ’åˆ—å‘¢ï¼Ÿæœ‰çš„ã€‚

- é€šå¸¸ `vptr` æ”¾åœ¨å¯¹è±¡é¦–éƒ¨ï¼ˆé¦–æˆå‘˜ï¼‰ï¼›
- ç´§æ¥å…¶åæ˜¯éè™šæˆå‘˜ï¼Œä¿æŒè‡ªç„¶å¯¹é½ï¼›
- æ‰€æœ‰è™šå‡½æ•°éƒ½åœ¨å•ä¸€ vtable ä¸­æŒ‰å£°æ˜é¡ºåºæ’åˆ— ã€‚

```
+---------------------+--------------------------------------------+
| å†…å­˜åŒºåŸŸ            | å†…å®¹æè¿°                                   |
+=====================+============================================+
|      è™šè¡¨æŒ‡é’ˆ       | æŒ‡å‘ AppCardWidget çš„è™šå‡½æ•°è¡¨               |
+---------------------+--------------------------------------------+
|                     |                                            |
|     æˆå‘˜å˜é‡        | DesktopToast* binding_toast                |
|                     | (ç»‘å®šçš„ toast å¯¹è±¡æŒ‡é’ˆ)                     |
|                     +--------------------------------------------+
|                     | Ui::AppCardWidget* ui                      |
|                     | (UI ç»„ä»¶æŒ‡é’ˆ)                              |
+---------------------+--------------------------------------------+
|     ç»§æ‰¿éƒ¨åˆ†        | QWidget åŸºç±»çš„æ‰€æœ‰æˆå‘˜æ•°æ®                 |
+---------------------+--------------------------------------------+
|     Qt ç‰¹æ€§         | Q_OBJECT å®æ·»åŠ çš„å…ƒå¯¹è±¡ç³»ç»Ÿæ•°æ®            |
|                     +--------------------------------------------+
|                     | Q_DISABLE_COPY å®ç¦ç”¨æ‹·è´åŠŸèƒ½              |
+---------------------+--------------------------------------------+

è™šè¡¨æŒ‡é’ˆæŒ‡å‘çš„æ˜¯->
+-----+---------------------------------------------+-----------+
| åç§» | å‡½æ•°ç­¾å                                   | ç±»å‹      |
+=====+=============================================+===========+
|  0  | ~AppCardWidget()                           | ææ„å‡½æ•°  |
+-----+---------------------------------------------+-----------+
|  1  | setCurrentIcon(const QPixmap&)             | è™šå‡½æ•°    |
+-----+---------------------------------------------+-----------+
|  2  | invoke_preLaunch_work()                    | çº¯è™šå‡½æ•°  |
+-----+---------------------------------------------+-----------+
|  3  | operate_comment_label()                    | çº¯è™šå‡½æ•°  |
+-----+---------------------------------------------+-----------+
|  4  | postAppCardWidget()                        | çº¯è™šå‡½æ•°  |
+-----+---------------------------------------------+-----------+
|  5  | setHelperFunction(const QString&)          | è™šå‡½æ•°    |
+-----+---------------------------------------------+-----------+
|  6  | setupSelfTextLabelStyle(QLabel*)           | çº¯è™šå‡½æ•°  |
+-----+---------------------------------------------+-----------+
|  7  | eventFilter(QObject*, QEvent*)             | è™šå‡½æ•°    |
+-----+---------------------------------------------+-----------+
```

## CRTP é™æ€å¤šæ€

â€‹	è¿™ä¸ªå°±è°ˆä¸ä¸Šè™šå‡½æ•°çš„å†…å®¹äº†ï¼Œä½†æ˜¯æ”¾åœ¨è¿™é‡ŒåŸå› å¾ˆç®€å•ï¼Œæˆ‘ä»¬è°ˆè®ºåˆ°è¿è¡Œæ—¶å¤šæ€çš„æ—¶å€™ï¼Œå¿…ç„¶è¦è·ŸCRTP é™æ€å¤šæ€åšåšå¯¹æ¯”ã€‚

â€‹	åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å®é™…ä¸Šï¼Œä¸å¤ªéœ€è¦çš„æ˜¯è¿è¡Œæ—¶å¤šæ€ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿ

```cpp
BaseClass* pSon = new DerivedClass();
pSon->aVirtualFunction();
```

â€‹	è¿™ä¸ªä»£ç æ˜¾ç„¶æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿è¡Œæ—¶å¤šæ€ï¼Œç†ç”±éå¸¸ç®€å•ï¼Œ**å› ä¸ºæˆ‘ä»¬çŸ¥é“pSonåœ¨è¿™ä¸ªé€»è¾‘æµä¸­æŒ‡å‘çš„æ˜¯ä¸€ä¸ªå…·ä½“çš„å­ç±»DerivedClass**ï¼Œè€Œä¸æ˜¯å…¶ä»–å¥‡å¥‡æ€ªæ€ªçš„ä¸œè¥¿ã€‚åŸºäºè¿™ä¸ªç†å¿µï¼Œæˆ‘ä»¬å‘ç°ä¸€äº›åœºæ™¯ä¸­å®Œå…¨ä¸éœ€è¦æ‰€è°“çš„è¿è¡Œæ—¶å¤šæ€ï¼Œæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™å°±é¢„æ–™åˆ°è¿™é‡Œä¸€å®šä¸ä¼šå‡ºç°è¿è¡Œæ‰èƒ½è£å†³çš„äº‹æƒ…ï¼Œå•¥å«è¿è¡Œæ—¶è£å†³å‘¢ï¼Ÿ

```cpp
void DesktopMainWindow::invoke_appcards_init() {
	/* sequencely invoke the work */
    showToast("AppCards Are Initing...");
    // each_app_cardsæ˜¯ä¸€ä¸ªçˆ¶ç±»ï¼Œè¿™ä¸ªçˆ¶ç±»è¡¨è¾¾è¿™ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªAppCardsï¼Œä½†æ˜¯å…·ä½“æ˜¯å•¥ï¼Œå¦‚ä½•æå‰æ´¾å‘åˆå§‹åŒ–çš„å·¥ä½œï¼Œç”±å­ç±»è‡ªå·±çš„invoke_preLaunch_workè£å†³ã€‚
	for (const auto& each_app_cards : std::as_const(this->app_cards)) {
		each_app_cards->invoke_preLaunch_work();
	}
    showToast("AppCards Init Finished!");
}
```

â€‹	è¿™ä¸ªå¡ç‰‡å¯èƒ½å®ä»ç”¨æˆ·æä¾›çš„æ’ä»¶åŠ¨æ€åº“ï¼Œå°†æ¥çš„æˆ‘åˆ›å»ºçš„ï¼Œä½†æ˜¯ç°åœ¨æˆ‘å®Œå…¨ä¸çŸ¥é“ä»–ä»¬çš„å…·ä½“çš„è¡Œä¸ºï¼Œä½†æ˜¯æˆ‘å¯ä»¥ä¿è¯ä»–ä»¬è‚¯å®šè‡³å°‘æ˜¯AppCardsï¼Œè¿™ä¸ªæ—¶å€™å°±è¦åˆ°è¿è¡Œçš„æ—¶å€™æ£€ç´¢ç±»å¯¹è±¡çš„å…ƒä¿¡æ¯æ‰¾å‡ºå¥¹åˆ°åº•æ˜¯è°ï¼Œç„¶åè°ƒç”¨å…·ä½“çš„ç±»å¯¹invoke_preLaunch_workçš„å®ç°

â€‹	æ‰€ä»¥ï¼ŒCRTPæ˜¯å•¥å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šCuriously Recurring Template Patternï¼Œå¥‡å¼‚é€’å½’æ¨¡æ¿æ¨¡å¼ã€‚è¿™ä¸ªç©æ„çš„åŸºæœ¬èµ·æ‰‹æ¡†æ¶æ˜¯è¿™æ ·çš„ã€‚ã€‚ã€‚

```c++
template <typename Derived>
class Base {
public:
    void interface() {
        // è°ƒç”¨æ´¾ç”Ÿç±»å®ç°çš„æ–¹æ³•
        static_cast<Derived*>(this)->implementation();
    }

    // å¯æä¾›é»˜è®¤å®ç°ï¼ˆå¯é€‰ï¼‰
    void implementation() {
        std::cout << "Base implementation\n";
    }
};

class Derived : public Base<Derived> {
public:
    void implementation() {
        std::cout << "Derived implementation\n";
    }
};
```

â€‹	è¿™å¾ˆæœ‰æ„æ€ï¼Œæˆ‘ä»¬å®é™…ä¸Šåˆ©ç”¨æ¨¡æ¿ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å°±è½¬å‘ç»™äº†æˆ‘ä»¬æŒ‡å®šçš„ç¼–è¯‘å™¨ç¡®å®šçš„Derivedç±»ã€‚è¿™å°±æ˜¯CRTPã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåœ¨è¯­æ³•ä¸Šï¼ŒBaseå’ŒDerivedå¯ä»¥è¯´æ˜¯æ¯«æ— å…³ç³»ï¼Œæˆ‘ä»¬åœ¨ä»£ç ç¼–å†™çš„æ—¶å€™æ‰ä¼šè€¦åˆåˆ°ä¸€èµ·ã€‚

- è¿™ä¸ªå¯æ˜¯å’Œä¼ ç»Ÿè™šå‡½æ•°çš„åŠ¨æ€å¤šæ€ä¸åŒï¼ŒCRTP åœ¨ **ç¼–è¯‘æœŸ**å°±å®Œæˆäº†å¤šæ€è¡Œä¸ºçš„åˆ†å‘ï¼ˆé€šè¿‡ `static_cast` å¼ºè½¬ä¸ºæ´¾ç”Ÿç±»ï¼‰ï¼Œæ²¡æœ‰è™šå‡½æ•°è¡¨ã€æ²¡æœ‰é—´æ¥è·³è½¬ï¼›
- ä¸ä¼šå› ä¸ºè™šå‡½æ•°é€ æˆ cache miss æˆ–å½±å“å†…è”ä¼˜åŒ–ï¼›
- å¯ä»¥å®ç°â€œæ¥å£ç»§æ‰¿â€æˆ–â€œè¡Œä¸ºæ³¨å…¥â€ã€‚

â€‹	æ‰€ä»¥CRTPåœ¨ç°ä»£C++ä¸­è¿˜æ˜¯æœ‰ä¸å°‘çš„èº«å½±çš„ï¼ˆæˆ‘æ²¡ç”¨åˆ°ï¼Œå› ä¸ºæˆ‘è¯„ä¼°æˆ‘çš„é¡¹ç›®æ˜¯å¦å¯ä»¥æœ‰æ½œåœ¨çš„æå‡çš„æ—¶å€™å‘ç°çœŸç”¨ä¸ä¸Šï¼‰ã€‚

â€‹	æ„Ÿè°¢GPTï¼Œä»–ç»™äº†æˆ‘ä¸€ä¸ªæ€»ç»“è¡¨æ ¼ï¼š

| ç‰¹æ€§            | CRTPï¼ˆé™æ€å¤šæ€ï¼‰         | è™šå‡½æ•°ï¼ˆåŠ¨æ€å¤šæ€ï¼‰ |
| --------------- | ------------------------ | ------------------ |
| å¤šæ€åˆ†å‘æ—¶æœº    | ç¼–è¯‘æœŸ                   | è¿è¡Œæ—¶             |
| æ˜¯å¦ä½¿ç”¨ vtable | å¦                       | æ˜¯                 |
| æ€§èƒ½å¼€é”€        | æ— é¢å¤–å¼€é”€ï¼Œå¯å†…è”ä¼˜åŒ–   | å­˜åœ¨è™šå‡½æ•°è°ƒç”¨å¼€é”€ |
| ç±»å‹çµæ´»æ€§      | ç¼–è¯‘æœŸå›ºå®šï¼Œç±»å‹å¿…é¡»å·²çŸ¥ | æ”¯æŒè¿è¡Œæ—¶å¤šæ€     |
| æ‰©å±•æ€§          | æ¨¡æ¿å±‚çº§éš¾ä»¥æŠ½è±¡å‡ºæ¥å£   | æ›´é€‚åˆæ¡†æ¶çº§æ¥å£   |

### ğŸ§± CRTP é™åˆ¶å’Œæ³¨æ„äº‹é¡¹

â€‹	CRTPæ˜¯å­˜åœ¨é—®é¢˜çš„ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªäº†è§£ï¼š

- **ç¼–è¯‘å¤æ‚åº¦å¢åŠ **ï¼šæ¨¡æ¿è†¨èƒ€ã€ç¼–è¯‘é”™è¯¯éš¾æ’æŸ¥ï¼Œæˆ‘æƒ³å¤§å®¶éƒ½è¢«è¯¥æ­»çš„æ¨¡æ¿æŠ¥é”™æŠ˜ç£¨è¿‡ï¼ˆå¥½åƒæ–°clangå¯¹æ¨¡æ¿çš„æŠ¥é”™ç¨å¾®å‹å–„äº†ç‚¹ï¼Ÿä½†æ˜¯æ’æŸ¥æ¨¡æ¿çš„æŠ¥é”™å±äºæ˜¯éå¸¸çš„ä¸å‹å¥½äº†ï¼‰
- **ä¸å¯è·¨ DLL è¾¹ç•Œä½¿ç”¨**ï¼šCRTP ä¾èµ–ç¼–è¯‘æœŸå±•å¼€ï¼Œè¿™å°±æ˜¯å› ä¸ºå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªä¾èµ–æ¨¡æ¿çš„é™æ€å¤šæ€æŠ€æœ¯ï¼Œå±äºæ˜¯ä»£ä»·äº†ã€‚
- **æ— æ³•é€šè¿‡æŒ‡é’ˆå­˜å‚¨åŸºç±»å¯¹è±¡**ï¼šé™¤éç”¨ `Base<Derived>*` è¿™æ ·çš„å…·ä½“ç±»å‹ï¼›
- **ç±»å‹ç»‘å®šå›ºå®š**ï¼šCRTP çš„â€œæ¥å£â€åªèƒ½ç»‘å®šä¸€ä¸ªç‰¹å®šæ´¾ç”Ÿç±»ï¼Œç¼ºä¹åŠ¨æ€æ‰©å±•èƒ½åŠ›ï¼›