# sbit&&sfr

1、c51扩展的数据类型

![img](https://pic2.zhimg.com/80/v2-1c5388c51da45b3a5814121c959f1eed_1440w.webp)

（1）bit

> 功能：用于定义一个位变量，位变量的寻址空间时通用RAM中可位寻址空间，位地址为00-7FH的。

例如：bit flag=0; //声明一个位变量flag，并初始化为0；

对于bit位变量：不能定义为指针变量；也不能定义为数组。

（2）sbit

> 功能：用于定义特殊功能寄存器（SFR）区中，可位寻址的特殊功能的地址。

例如：sbit P10=0x90；//定义位变量P10的位地址为90H，即P1.0引脚

sibt INT0=0xB2；//定义位变量INT0为B2H，即P3.2引脚

sbit Cy=0xD7；//定义Cy为D7H，也就是PSW的最高位

注意：

- sbit数据类型，“=”后给出的是sbit类型变量的地址。
- bit数据类型，“=”后给出的时bit类型的初始化。

（3）sfr

> 功能：用于定义8位特殊功能寄存器的地址

例如：sfr P0=0x80；//定义P0口的地址为80H

sfr PSW=0xD0；//定义PSW的地址时D0H

（4）sfr16

> 功能：用于声明16位特殊功能寄存器的地址，要求这16位sfr的低字节和高字节是连续存储的，在声明中只要给出低字节地址。

例如：sfr16 DPTR=0x82；//实际DPTR地址为DPL=0x82，DPH=0x83

对于8051MCU中的sbit、sfr、sfr16的地址，在头文件reg51.h、reg52.h中进行了定义，所以用户只要在程序前，用include进行包含即可。



![img](https://pic2.zhimg.com/80/v2-ded752b45022fce434a88d5a2ef34a21_1440w.webp)

![img](https://pic1.zhimg.com/80/v2-d1fd0bd72d001e4aea2abcf93c05e628_1440w.webp)

2、变量定义

（1）格式：数据类型 [存储器类型] 变量名

```text
        存储器类型：是指c51变量的存储器空间。有三个区域，分别为ROM,，内部RAM，外部RAM。
```

![img](https://pic2.zhimg.com/80/v2-2f59f34911e8755d8c6da3cc4d69a0f5_1440w.webp)

（2）存储器类型

> 程序存储器ROM：关键字为code；对于8051MCU，程序存储空间是64k。
> 内部数据存储器，分三种类型：

- data：内部RAM直接寻址的低128字节，寻址范围是00H-7FH；该存储器类型的访问速度最快。
- idata：全部256B的内部直接寻址RAM空间，寻址范围00H-FFH；访问速度比直接寻址慢。
- bdata：内部RAM中的可位寻址空间，位地址为00H-7FH；声明可位寻址的数据类型。

> 外部数据存储器：

- xdata：寻址空间是外部64KRAM字节。
- pdata：寻址空间是分页的外部RAM，256字节/每页。

## 注意：对于没有声明存储器类型的变量，自动选择编译器的存储器模式。编译器的存储模式有SMALL、COMPACT及LARGE三种。

（3）存储模式

small：默认所有缺省存储器类型声明的变量的存储器类型为data。优点是访问速度快，缺点是空间有限，适用于小程序。

compact模式：默认所有缺省存储器类型声明的变量的存储器类型为pdata。优点是存储空间比small大，速度比small慢、但比large要快。

large模式：默认所有缺省存储器类型声明的变量的存储器类型为xdata。优点是空间大，可存变量多，缺点是生成的代码长、速度慢。

3、数组

（1）一维数组

```text
格式：数据类型  [存储器类型]  数组名  [常量表达式]；
```

（2）二维数组

```text
 格式：数据类型  [存储器类型]  数组名   [常量表达式1][常量表达式2]
```

4、指针

C51编译器提供两种不同的指针类型：通用指针和存储器特殊指针

（1）通用指针

```text
格式：数据类型 * [指针变量的存储器类型]  指针变量
```

（2）特殊指针

```text
格式：数据类型  变量存储器类型 * [指针变量存储器类型]  指针变量
```

与通用指针相比，特殊指针包含了变量存储器类型；特殊指针必须指定变量的存储器类型，即其只访问规定存储空间变量。

> char data *str；//指针str，指向内部RAM data区的字符型变量；指针的存储器类型缺省。
> long code *powtab；//指针powtab，指向ROM空间的长整型变量；指针的存储器类型缺省。
> char data * xdata str；//指针str，指向内部RAM data区的字符型变量，指针str存放在外部RAM xdata空间
> int xdata *data numtab；//指针numtab，指向外部RAM xdata空间的整型变量；指针numtab存放在内部RAM data空间。

（3）通用指针和特殊指针

- 通用指针可以用来访问所有存储器类型的变量，既可以不用考虑变量存储在哪个存储空间，使用方便，但执行速度比特殊指针慢。
- 通用指针和特殊指针所占用的字节数不一样，特殊指针占用字节少。
- 特殊指针比通用指针效率高、速度快。



### 解惑：P0^1的用法

​		这个是sbit定义的用法，大概就是说sbit 位变量=sfr名称^位地址，说白了就是P0^1只能在位定义sbit中正确表达，在其他地方就不可以（在其他地方“^”是异或运算，和与或非是一样的），而且这种表达方式也只能在兼容51指令集的单片机中运用，比如在stm单片机或者是其他arm内核的单片机中就没有sbit这种定义方法。