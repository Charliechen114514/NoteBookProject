# è®¨è®ºQStringçš„å„ç§to...

## ğŸŒ èŠä¸€èŠç¼–ç ï¼šä»€ä¹ˆæ˜¯å­—ç¬¦ç¼–ç ï¼ˆCharacter Encodingï¼‰ï¼Ÿ

å­—ç¬¦ç¼–ç æ˜¯ **å°†å­—ç¬¦è½¬ä¸ºäºŒè¿›åˆ¶æ•°å­—** çš„ä¸€ç§è§„åˆ™ã€‚

ä¾‹å¦‚ï¼Œå­—ç¬¦ `'A'` åœ¨ UTF-8 ä¸­å¯¹åº”äºŒè¿›åˆ¶æ˜¯ `01000001`ï¼ˆASCII çš„ 65ï¼‰ï¼Œè€Œæ±‰å­— `'ä½ '` åœ¨ UTF-8 ä¸­æ˜¯ `0xE4BD A0`ï¼Œ3 ä¸ªå­—èŠ‚ã€‚

ä¸åŒç¼–ç ä¼šç”¨ä¸åŒçš„æ–¹å¼å¯¹å­—ç¬¦è¿›è¡Œç¼–ç ï¼š

| å­—ç¬¦ | UTF-8     | GBK    | UTF-16 |
| ---- | --------- | ------ | ------ |
| A    | 0x41      | 0x41   | 0x0041 |
| ä½    | 0xE4BD A0 | 0xC4E3 | 0x4F60 |



------

## ğŸ”¤ Qt çš„ `QString` é»˜è®¤ä½¿ç”¨ **UTF-16**

`QString` æ˜¯ Qt çš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨ **UTF-16** å­˜å‚¨æ‰€æœ‰å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å†™ `QString str = "ä½ å¥½";` æ—¶ï¼Œè¿™ä¸¤ä¸ªå­—å…¶å®æ˜¯ä»¥ UTF-16 æ ¼å¼å­˜åœ¨å†…å­˜ä¸­çš„ã€‚

------

## ğŸ§­ å¸¸è§ç¼–ç çš„ç®€ä»‹ä¸é€‚ç”¨åœºæ™¯

| ç¼–ç                      | ç‰¹ç‚¹                                                         | é€‚ç”¨                                  |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------- |
| **UTF-8**                | å¯å˜é•¿åº¦ï¼ˆ1-4å­—èŠ‚ï¼‰ï¼Œå…¼å®¹ ASCIIï¼Œå›½é™…åŒ–æ ‡å‡†                  | ç½‘ç»œä¼ è¾“ã€è·¨å¹³å°æ–‡ä»¶ã€ç°ä»£è½¯ä»¶æ ‡å‡†    |
| **UTF-16**               | æ¯å­—ç¬¦ä¸€èˆ¬ç”¨2æˆ–4å­—èŠ‚ï¼Œé€‚åˆå­˜å‚¨æ‰€æœ‰è¯­è¨€                       | Windowså†…éƒ¨APIã€`QString`å†…éƒ¨ã€Javaç­‰ |
| **GBK/GB2312**           | ä¸­æ–‡ä¸“ç”¨ç¼–ç ï¼Œå•/åŒå­—èŠ‚æ··åˆ                                  | ä¸­æ–‡Windowsç³»ç»Ÿä¸‹è€ç¨‹åºã€ç®€ä½“ä¸­æ–‡æ–‡æ¡£ |
| **ISO-8859-1 (Latin1)**  | å•å­—èŠ‚ç¼–ç ï¼Œé€‚ç”¨äºè¥¿æ¬§å­—ç¬¦                                   | è¥¿æ¬§å›½å®¶æ–‡æ¡£ã€æ—§ç³»ç»Ÿ                  |
| **æœ¬åœ°ç¼–ç  (Local8Bit)** | ç³»ç»Ÿå½“å‰çš„ç¼–ç ï¼Œæ¯”å¦‚ç®€ä½“ä¸­æ–‡æ˜¯ GBKã€ç¹ä½“ä¸­æ–‡æ˜¯ Big5ã€è‹±æ–‡æ˜¯ UTF-8 | ä¸ç³»ç»Ÿ APIã€æ§åˆ¶å°äº¤äº’                |

â€‹	åœ¨æˆ‘ä»¬ç†Ÿæ‚‰äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ç»§ç»­çœ‹ä¸€çœ‹Qtçš„å„ç§toäº†ï¼š

# Qtçš„å„ç§è½¬åŒ–

## ä¸€ã€ç¼–ç ç›¸å…³çš„è½¬æ¢å‡½æ•°ï¼ˆè¿”å› `QByteArray`ï¼‰

è¿™äº›å‡½æ•°å°† `QString` è½¬æ¢ä¸ºä¸åŒç¼–ç æ ¼å¼çš„ `QByteArray`ï¼Œé€‚åˆä¸åº•å±‚ C/C++ æ¥å£æˆ–æ–‡ä»¶ã€ç½‘ç»œç­‰ç³»ç»Ÿäº¤äº’ï¼š

| å‡½æ•°                            | è¯´æ˜                                                         | å¸¸è§ç”¨é€”                                          |
| ------------------------------- | ------------------------------------------------------------ | ------------------------------------------------- |
| `toUtf8()`                      | è½¬æ¢ä¸º UTF-8 ç¼–ç çš„ `QByteArray`                             | ç½‘ç»œä¼ è¾“ã€ä¿å­˜ä¸º UTF-8 æ–‡ä»¶ç­‰                     |
| `toLatin1()`                    | è½¬æ¢ä¸º ISO-8859-1ï¼ˆLatin1ï¼‰ç¼–ç                               | è¥¿æ¬§è¯­è¨€ç¯å¢ƒä½¿ç”¨                                  |
| `toLocal8Bit()`                 | è½¬æ¢ä¸ºæœ¬åœ°ç¼–ç ï¼ˆå¦‚ GBKã€BIG5 ç­‰ï¼‰                            | ä¸æœ¬åœ°å¹³å°ç³»ç»Ÿäº¤äº’ï¼ˆå¦‚ Windows æ§åˆ¶å°ã€æ–‡ä»¶è·¯å¾„ï¼‰ |
| `toStdString()`                 | è½¬æ¢ä¸º `std::string`ï¼Œæœ¬è´¨ä½¿ç”¨ `toUtf8()` æˆ– `toLocal8Bit()` | å’Œæ ‡å‡†åº“æ¥å£äº¤äº’                                  |
| `toWCharArray(wchar_t* buffer)` | å°†å­—ç¬¦ä¸²å†…å®¹å¤åˆ¶åˆ°å®½å­—ç¬¦æ•°ç»„ä¸­ï¼ˆ`wchar_t[]`ï¼‰                | Windows API ç­‰å®½å­—ç¬¦æ¥å£                          |
| `utf16()`                       | è¿”å› UTF-16 ç¼–ç çš„æŒ‡é’ˆï¼ˆ`const ushort*`ï¼‰                    | ä¸ Windows æˆ– Unicode åº•å±‚ API äº¤äº’               |

### 1. `toUtf8()` â€” è½¬æˆ UTF-8 æ ¼å¼çš„ QByteArray

```cpp
QString str = "ä½ å¥½";
QByteArray bytes = str.toUtf8();
```

- è¾“å‡ºï¼š`bytes` æ˜¯ UTF-8 ç¼–ç çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚
- **ç”¨é€”ï¼š** ç½‘ç»œä¼ è¾“ã€ä¿å­˜ä¸º UTF-8 æ–‡ä»¶ã€è¾“å‡ºç»™æ”¯æŒ UTF-8 çš„ç³»ç»Ÿã€‚

------

### 2. `toLocal8Bit()` â€” è½¬æˆç³»ç»Ÿå½“å‰çš„ç¼–ç ï¼ˆæœ¬åœ°ç¼–ç ï¼‰

```cpp
QString str = "ä½ å¥½";
QByteArray localBytes = str.toLocal8Bit();
```

- åœ¨ **ç®€ä½“ä¸­æ–‡ Windows** ä¸Šï¼Œç»“æœæ˜¯ GBK ç¼–ç ã€‚
- **ç”¨é€”ï¼š** æ§åˆ¶å°è¾“å‡ºã€ä¸æœ¬åœ° APIã€æ—§ C æ¥å£äº¤äº’ã€‚

âœ… ç‰¹åˆ«æç¤ºï¼š

```cpp
printf("%s", str.toLocal8Bit().data()); // æ§åˆ¶å°è¾“å‡ºä¸­æ–‡ï¼ˆWindowsï¼‰
```

------

### 3. `toLatin1()` â€” è½¬æˆ ISO-8859-1ï¼ˆLatin1ï¼‰æ ¼å¼

```cpp
QString str = "Hello";
QByteArray latin = str.toLatin1();
```

- **ä»…æ”¯æŒè¥¿æ¬§å­—ç¬¦**ï¼ˆå¦‚è‹±æ–‡å­—æ¯ã€æ•°å­—ã€æ³•æ–‡ç­‰ï¼‰ï¼Œä¸­æ–‡ä¼šå˜æˆä¹±ç ã€‚
- **ç”¨é€”ï¼š** è¥¿æ¬§è¯­è¨€ç¯å¢ƒç³»ç»Ÿæˆ–åµŒå…¥å¼æ—§å¹³å°ã€‚

------

### 4. `toStdString()` â€” è½¬æˆ `std::string`

```cpp
std::string s = str.toStdString(); // å®è´¨ç­‰ä»·äº str.toUtf8().toStdString()
```

- é€‚åˆå’Œæ ‡å‡† C++ åº“æˆ–æ—§æ¥å£æ··ç”¨ã€‚
- ä¸å»ºè®®åœ¨å¤„ç†ä¸­æ–‡æ—¶ç”¨ `std::string`ï¼Œå› å®ƒå¯¹ç¼–ç æ— æ„Ÿã€‚

## ğŸ§· ä¸¾ä¸ªåœºæ™¯ä¾‹å­

å‡è®¾ä½ è¦æŠŠ `QString` å†™åˆ°æ–‡ä»¶æˆ–å‘åˆ°ç½‘ç»œä¸Šï¼Œä¸åŒåœºæ™¯åº”é€‰æ‹©ä¸åŒç¼–ç ï¼š

| åœºæ™¯                              | åº”ä½¿ç”¨                            |
| --------------------------------- | --------------------------------- |
| ä¸æœ¬åœ° Windows æ§åˆ¶å°æ‰“å°ä¸­æ–‡     | `toLocal8Bit()`                   |
| å†™å…¥ UTF-8 ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶         | `toUtf8()`                        |
| ä¸ C++ æ ‡å‡†åº“ï¼ˆå¦‚ `fstream`ï¼‰é…åˆ | `toUtf8().toStdString()`          |
| å‘é€å­—ç¬¦ä¸²åˆ°åµŒå…¥å¼è®¾å¤‡ä½¿ç”¨ GBK    | `toLocal8Bit()`ï¼ˆéœ€è®¾ç½®ç³»ç»Ÿç¼–ç ï¼‰ |

> âœ… æ³¨æ„ï¼š
>
> - `QString` å†…éƒ¨ä½¿ç”¨ **UTF-16** å­˜å‚¨ï¼Œå› æ­¤è½¬æ¢ä¸ºå…¶ä»–ç¼–ç éƒ½éœ€è¦ç¼–ç è¿‡ç¨‹ã€‚
> - `toLocal8Bit()` åœ¨ä¸åŒç³»ç»Ÿä¸‹å¯èƒ½ç¼–ç ä¸åŒï¼Œæ¯”å¦‚ Windows ä¸Šæ˜¯ GBKï¼ˆç®€ä¸­ç³»ç»Ÿï¼‰ã€Linux ä¸‹æ˜¯ UTF-8 æˆ–å…¶ä»–æœ¬åœ°ç¼–ç ã€‚

------

## äºŒã€è½¬æ¢ä¸ºæ•°å€¼ç±»å‹

ç”¨äºå°† `QString` è½¬æ¢ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¦‚æ•´æ•°ã€æµ®ç‚¹æ•°ç­‰ï¼š

| å‡½æ•°                     | è¿”å›ç±»å‹  | ç¤ºä¾‹                                   |
| ------------------------ | --------- | -------------------------------------- |
| `toInt(&ok, base)`       | `int`     | åè¿›åˆ¶æˆ–å…¶ä»–è¿›åˆ¶æ•´æ•°                   |
| `toUInt(&ok, base)`      | `uint`    | æ— ç¬¦å·æ•´æ•°                             |
| `toLongLong(&ok, base)`  | `qint64`  | å¤§æ•´æ•°                                 |
| `toULongLong(&ok, base)` | `quint64` | æ— ç¬¦å·å¤§æ•´æ•°                           |
| `toFloat(&ok)`           | `float`   | æµ®ç‚¹æ•°                                 |
| `toDouble(&ok)`          | `double`  | åŒç²¾åº¦æµ®ç‚¹æ•°                           |
| `toBool()`               | `bool`    | è¿”å›æ˜¯å¦ä¸º "true"ã€"1"ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ |



> å‚æ•° `ok` æ˜¯å¯é€‰çš„ï¼Œç”¨äºè¾“å‡ºæ˜¯å¦æˆåŠŸè½¬æ¢ã€‚
>
> ```
> bool ok;
> int val = str.toInt(&ok);
> if (ok) { ... }
> ```

------

## ä¸‰ã€è½¬æ¢ä¸ºæ ‡å‡† C/C++ ç±»å‹

| å‡½æ•°               | è¿”å›ç±»å‹         | è¯´æ˜                     |
| ------------------ | ---------------- | ------------------------ |
| `toStdString()`    | `std::string`    | è½¬æ¢ä¸º UTF-8 å­—ç¬¦ä¸²      |
| `toStdU16String()` | `std::u16string` | å¯¹åº” UTF-16              |
| `toStdU32String()` | `std::u32string` | å¯¹åº” UTF-32              |
| `toStdWString()`   | `std::wstring`   | å®½å­—ç¬¦å­—ç¬¦ä¸²ï¼ˆå¹³å°ç›¸å…³ï¼‰ |



------

## å››ã€ä¸ C é£æ ¼å­—ç¬¦ä¸²äº¤äº’ï¼ˆä½¿ç”¨ä¸´æ—¶çš„ `QByteArray`ï¼‰

è™½ç„¶æ²¡æœ‰ `toCharArray()`ï¼Œä½†ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```
const char* cstr = str.toLocal8Bit().constData();
```

- æ³¨æ„è¿™æ˜¯ä¸´æ—¶å˜é‡ï¼Œå¿…é¡»ç¡®ä¿ `QByteArray` ç”Ÿå‘½å‘¨æœŸè¶³å¤Ÿé•¿ã€‚

â€‹	ä¸¾ä¸ªä¾‹å­ï¼š

```
QString str = "ä½ å¥½123";

// ç¼–ç è½¬æ¢
QByteArray utf8 = str.toUtf8();       // UTF-8 ç¼–ç 
QByteArray local = str.toLocal8Bit(); // æœ¬åœ°ç¼–ç ï¼ˆå¦‚GBKï¼‰

// æ•°å€¼è½¬æ¢
bool ok;
int num = QString("42").toInt(&ok);   // è½¬æˆæ•´æ•°

// ä¸æ ‡å‡†åº“å…¼å®¹
std::string stdStr = str.toStdString();
```