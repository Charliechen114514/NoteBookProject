# 从0开始使用面对对象C语言搭建一个基于OLED的图形显示框架

## 前言

​	笔者前段时间花费了一周，整理了一下自从TM1637开始打算的，使用OLED来搭建一个通用的显示库的一个工程。笔者的OLED库已经开源到Github上了，地址在：[MCU_Libs/OLED at main · Charliechen114514/MCU_Libs (github.com)](https://github.com/Charliechen114514/MCU_Libs/tree/main/OLED)

​	框架目前的最终目的，是设计一个丝滑的带有动画和图标的动态多级菜单。笔者会尽可能详细的介绍自己的设计思路，供大家参考。

## 环境介绍

​	首先，笔者惯用的是PlatformIO作为嵌入式开发的IDE，CubeMx作为方便的代码生成器辅助笔者进行快速的工作。各位可能更多使用的是CubeIDE或者是MDK5，关于这个，笔者会尽可能详细的阐述一些可能异于平台操作的操作。这里需要各位自行动手做更改！

## 代码与动机

​	关于江科大的OLED代码和以KeysKing作为代码的优秀的嵌入式工程师的代码，笔者早就有所拜读，这些代码更多的是出于一种“可用的”而不是可复用的，代码风格上，笔者更青睐于KeysKing大佬的代码风格。但是笔者在移植的时候出现了一些困扰，导致最终失败。笔者随后决定基于KeysKing的思路，使用江科大的代码作为参考，使用Linux设备代码抽象的架构与面对对象C重新设计一套完整的OLED框架，全面的支持软硬件IIC和软硬件SPI。支持参数不同，大小不同的OLED作为显示。这也是笔者的一次大型的C语言工程训练。新手上路，多多包涵！

​	如果你并不关心如何实现的，只是想快速实现如何使用，请到[MCU_Libs/OLED/library at main · Charliechen114514/MCU_Libs (github.com)](https://github.com/Charliechen114514/MCU_Libs/tree/main/OLED/library)中直接拷贝两份代码，将所有代码添加进入你的工程（如果您有确定的OLED协议，请自行适当裁剪，笔者的代码极低耦合，可以直接删除不需要的代码）

​	如果你关心的是如何实现的，这就是笔者写这个系列博客的目的。

## 架构设计，优缺点

​	简单的讲，分为协议层（使用何种协议进行通信？），设备层（这个设备可以做什么？），图像层（可以使用设备绘制哪一些图像？），组件层（可以使用图像绘制哪一些组件？），层层递进，保证互相之间互不干扰。

​	优点我说了，低耦合高内聚，笔者添加支持SSD1309的代码，从头到尾只是修改了两行代码 + 添加一行修正（`X += 2`），跑起来了整个框架。其他的代码笔者丝毫未动。

​	缺点就是老生常谈的效率问题。整个事情需要良好的抽象。尽可能大的变量复用，确保敏感部分的函数跳转尽可能少，对OLED的特性尽可能熟悉，对自己的要求很高。

## 看看效果？

​	如下的演示视频是硬件SPI + 2.42寸的SSD1309 OLED演示。

<video src="./video/81cee7d0d81d4e7ac565a17e83344ed6.mp4"></video>



