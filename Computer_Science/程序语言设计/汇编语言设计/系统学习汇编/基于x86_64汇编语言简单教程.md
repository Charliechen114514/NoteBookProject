# åŸºäºx86_64æ±‡ç¼–è¯­è¨€ç®€å•æ•™ç¨‹

## å‰è¨€

â€‹	ç¬”è€…æœ€è¿‘æ­£åœ¨æ¢­å“ˆä½¿ç”¨NASMæ±‡ç¼–å™¨çš„x86 32ä½æ±‡ç¼–ï¼Œç¬”è€…è¿™é‡Œè®°å½•ä¸€ä¸‹ä¸€ä¸ªæ™šä¸Šçš„æˆæœã€‚

## ç¯å¢ƒé…ç½®

### åŸºæœ¬ç¡¬ä»¶ä¸æ“ä½œç³»ç»Ÿè¦æ±‚

â€‹	å¦‚æœæ‚¨æ˜¯Linuxå¸¸å®¢ï¼Œæˆ–è€…å·²ç»æœ‰äº†WSLä¸”ä½¿ç”¨VSCode SSHè¿æ¥è¿›è¡Œäº†ä¸€æ®µæ—¶é—´çš„å¼€å‘ï¼Œåªéœ€è¦è·³è½¬é“ç¯å¢ƒå®‰è£…å°±OKã€‚

### WSL + VSCodeåŸºæœ¬é…ç½®`(For Windows)`

â€‹	ç¬”è€…ä¸»è¦æ˜¯åœ¨Linuxå‘è¡Œç‰ˆä¸‹å°è¯•æ±‡ç¼–ï¼ˆåŸå› æ˜¯ç®€å•è€Œåˆæ–¹ä¾¿ï¼Œå±äº‹å°‘ï¼‰ï¼Œè¿™é‡Œå»ºè®®å‚è€ƒæœ¬äººæ•™ç¨‹çš„åŒå¿—ä»¬é…ä¸€ä¸ªWSL2ã€‚ç„¶åå°±å¯ä»¥å¼€å§‹codingäº†ã€‚

> `Preparing for the Assembly Coding:`[å¼€å§‹é€šè¿‡ WSL ä½¿ç”¨ VS Code | Microsoft Learn](https://learn.microsoft.com/zh-cn/windows/wsl/tutorials/wsl-vscode)

### å®‰è£…åŸºæœ¬çš„ä¾èµ–

â€‹	å¥½åœ¨NASMå¾ˆè½»é‡ï¼Œå‡ ä¹ä¸€ç¬é—´å°±å¯ä»¥ä¸‹è½½å®Œæˆï¼š

> å¦‚æœæ‚¨æ˜¯Ubuntuæˆ–è€…å‘è¡Œç‰ˆä½¿ç”¨aptç®¡ç†

```
sudo apt install nasm # for Ubuntu or any Releases owns apt as the main package manager
```

> æˆ–è€…æ‚¨æ˜¯Arch Linuxè†é¦–ï¼

```
yay -Ss nasm	# do this if u r using yay
```

â€‹	å½“ç„¶ï¼Œæ‚¨å¯ä»¥çœ‹çœ‹è‡ªå·±æœ‰æ²¡æœ‰GDBï¼Œè¿™æ˜¯æˆ‘ä»¬ç”¨æ¥è°ƒè¯•æ‚¨å†™çš„æ±‡ç¼–ç¨‹åºçš„ï¼

```
sudo apt install gdb ; download gdb if u r using apt 
yay -Ss gdb; download gdb if u r using yay
```

â€‹	æµ‹è¯•ä¸€ä¸‹ï¼š

```
charliechen@Charliechen:~/demo/demo5$ nasm -v
NASM version 2.16.01
charliechen@Charliechen:~/demo/demo5$ gdb -v
GNU gdb (Ubuntu 15.0.50.20240403-0ubuntu1) 15.0.50.20240403-git
Copyright (C) 2024 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```

### ä¸ºæ‚¨çš„VSCodeå®‰è£…æ’ä»¶ï¼š

> ç›´æ¥æœNASMï¼Œä¸‹è½½è¿™ä¸ªï¼š
>
> ![image-20241019223847524](./åŸºäºx86_64æ±‡ç¼–è¯­è¨€ç®€å•æ•™ç¨‹/image-20241019223847524.png)

â€‹	æ²¡äº†ï¼ç°åœ¨ï¼Œè®©æˆ‘ä»¬åšæœ€åçš„æ£€æŸ¥ï¼šğŸ‘‡

## å­¦ä¹ è¦æ±‚

â€‹	ç¬”è€…éœ€è¦å‡è®¾æ‚¨

- ä¼šä½¿ç”¨åŸºæœ¬çš„Linuxå‘½ä»¤è¡Œ
- å­¦ä¹ è¿‡è‡³å°‘ä¸€é—¨é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼Œå•Šå“ˆï¼å¦‚æœæ˜¯Cï¼Œè¿˜å¾ˆç†Ÿç»ƒé‚£å°±æ›´å¥½äº†ï¼
- æœ‰è¿‡GCCå‘½ä»¤è¡Œç¼–è¯‘çš„ç»å†ï¼ˆä¸æ±‚ç»éªŒï¼Œç¬”è€…è‡ªå·±å°±ä¸å’‹åœ°...
- ï¼ˆBonus!ï¼‰ä¼šä½¿ç”¨GDBè°ƒè¯•æ‚¨çš„ç¨‹åºï¼
- `(Great Bonus!)`æœ‰è¿‡å¾®æœºåŸç†/ è®¡ç®—æœºç»„æˆåŸç†/æ“ä½œç³»ç»Ÿ ä¸‰é—¨è¯¾ç¨‹ä¸­è‡³å°‘ä¸€é—¨çš„ä¸Šè¯¾ç»éªŒï¼ˆè²Œä¼¼æ‚¨ä¸éœ€è¦çœ‹è¿™ç¯‡æ•™ç¨‹äº†ï¼‰

â€‹	æˆ‘ç›¸ä¿¡ä»»ä½•ä¸€ä¸ªå…¥é—¨è®¡ç®—æœºæœ€è¿Ÿä¸€å¹´çš„å„ä½çœ‹å®˜éƒ½å¯ä»¥è½»æ¾èƒœä»»ä¸Šé¢çš„ä»»ä½•ä¸€æ¡è¦æ±‚ã€‚æ‰€ä»¥ï¼Œæ»¡è¶³ä¸Šè¿°æ¡ä»¶ï¼Œæ‚¨å¯ä»¥å¼€å§‹æ±‡ç¼–ä¹‹æ—…äº†ï¼

## å…¥é—¨

### å…ˆè¯•è¯•å‘³é“

â€‹	ç¬”è€…èŠ±è´¹äº†ï¼Œå—¯ï¼Œå¤§æ¦‚å‡ åˆ†é’Ÿçš„æ—¶é—´ä¸ºæ‚¨å†™äº†ä¸€ä»½Hello, World!

```
; --------------------------------------------------
;   Program written in 10.19 2024
;   Author:             Charlie chen
;   Functionality:      Print Hello, Assembly to the console 
; --------------------------------------------------

; è‹±æ–‡åˆ†å·; åçš„ä¸€è¡Œè¡¨è¾¾çš„æ˜¯è¿™ä¸€è¡Œæ˜¯æ³¨é‡Šï¼Œæ±‡ç¼–å™¨è‡ªåŠ¨jmpåé¢çš„å†…å®¹å½“ä½œç©ºç™½ :|

; è¿™é‡Œå­˜æ”¾æ•°æ®ï¼
section .data
    ; ä¸‹é¢å®šä¹‰çš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², å­¦ä¹ è¿‡é«˜çº§ç¼–ç¨‹è¯­è¨€ï¼ˆexcept C then :) ï¼‰çš„éƒ½çŸ¥é“
    ; å­—ç¬¦ä¸²éœ€è¦ç»´æŠ¤ä¸€ä¸ªå­—ç¬¦æ•°ç»„å’Œé•¿åº¦
    ; è¿™é‡Œæˆ‘ä»¬å°±æ˜¯è¿™æ ·åšçš„
    hello_string        db "Hello, Assembly!", 0xA
    hello_string_len    equ $ - hello_string

; è¿™é‡Œå­˜æ”¾æˆ‘ä»¬å†™çš„ä»£ç 
section .text
    ; å‘ŠçŸ¥æ±‡ç¼–å™¨: è¯·æŠŠ_startç¬¦å·å‘å¤–é¢æš´éœ²ï¼
    ; è¿™æ ·ï¼Œé“¾æ¥å™¨å°±ä¼šæ‰¾åˆ°è¿™ä¸ªç¬¦å·è§£å†³undefined reference 
    global _start

; å¼€å§‹æˆ‘ä»¬çš„ç¨‹åº
_start:
	; write(1, "Hello, Assembly!", sizeof(Hello, Assembly!));
    mov eax, 4                  ; SYS_WRITE
    mov ebx, 1                  ; stdout çš„ file descripter
    mov ecx, hello_string       ; å­—ç¬¦ä¸²åœ°å€
    mov edx, hello_string_len   ; æ‰“å°å­—ç¬¦çš„ä¸ªæ•°ï¼šè¿™é‡Œæˆ‘ä»¬é€‰æ‹©å…¨éƒ¨æ‰“å°
    int 0x80                    ; å‘èµ·128å·ä¸­æ–­
	; Like exit(0) then huh? :>
    mov eax, 1                  ; SYS_EXIT
    mov ebx, 0                  ; å‚æ•°0è¡¨ç¤ºæ­£å¸¸é€€å‡º
    int 0x80                    ; å‘èµ·128å·ä¸­æ–­
```

â€‹	ç°åœ¨ï¼Œè¯·ä½ æå‡ºæœ€å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆç¬”è€…æ˜¯VSCodeï¼‰ï¼Œå°†ä¸Šé¢çš„ä»£ç CVã€‚ç„¶åè®°å¾—ä¿å­˜ :)ç¬”è€…ä¿å­˜çš„æ˜¯test.asm

â€‹	ç°åœ¨ï¼Œä½ å¯ä»¥å¼€å§‹ä½¿ç”¨NASMæ±‡ç¼–å™¨å¼€å§‹ä½ çš„è¡¨æ¼”ï¼š

```
nasm -g -f elf32 test.asm1 -o test.o
```

> ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤æŒ‡æŒ¥NASMå°†test.asmæ±‡ç¼–æ–‡ä»¶æ±‡ç¼–æˆå…¨éƒ¨ç”±æœºå™¨æŒ‡ä»¤æ„æˆçš„test.oæ–‡ä»¶ã€‚.oæ–‡ä»¶æ˜¯ä¸€ä¸ªrelocatableçš„é‡å®šä½æ–‡ä»¶ã€‚æˆ‘ä»¬åé¢ä¼šè°ˆåˆ°å•¥å«é‡å®šä½ï¼Œä½†ä¸æ˜¯ç°åœ¨ :)
>
> - -g : ç”Ÿæˆè¯¦ç»†çš„è°ƒè¯•ç¬¦å·ï¼Œæ‚¨åœ¨å‘å¸ƒæ‚¨çš„ç¨‹åºç»™å…¶ä»–äººä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœå¯¹æ–¹åªæ˜¯ä½¿ç”¨æ‚¨çš„ç¨‹åºï¼Œè¯·å»æ‰-gï¼Œæ‚¨ä¹Ÿä¸å¸Œæœ›åˆ«äººæŠŠä½ çš„ç¨‹åºä¸€çœ¼æœ›ç©¿ :)
> - -f : Formatï¼ä»€ä¹ˆæ ¼å¼å‘¢ï¼Ÿç¬”è€…çš„OSæ˜¯Linux Kernel Releasesçš„Ubuntuï¼Œé‚£å°±éœ€è¦ELFæ–‡ä»¶ã€‚æˆ‘ä»¬çš„æ±‡ç¼–æ˜¯32ä½ï¼Œéµå¾ª32ä½çš„æ–‡ä»¶æ ¼å¼ï¼æ‰€ä»¥å¸¦ä¸Šå‚æ•°elf32ï¼Œå½“ç„¶åé¢è‡ªå·±å†™64ä½æ±‡ç¼–çš„æ—¶å€™å°±ä¸ç”¨-fäº†ï¼Œé»˜è®¤æ˜¯elf64
> - -oï¼šoutput is what? Oh! it''s test.o :)

â€‹	ç°åœ¨è¯·æ‚¨lsä¸€ä¸‹æ‚¨çš„æ–‡ä»¶å¤¹

```
charliechen@Charliechen:~/demo/demo5$ ls
test.asm  test.o
```

â€‹	éå¸¸å¥½ï¼ä½†æ˜¯æˆ‘ä»¬ä»ç„¶æ— æ³•æ‰§è¡Œå®ƒï¼å› ä¸ºè¿˜æ²¡æœ‰ä½¿ç”¨é“¾æ¥å™¨è¿æ¥å¿…è¦çš„æ–‡ä»¶ï¼ˆå…·ä½“æ˜¯å•¥ï¼Ÿå½“ç„¶ï¼Œæ˜¯ä¸€äº›æŒ‡æŒ¥æ“ä½œç³»ç»Ÿåˆ†é…çš„å·¥ä½œï¼Œä½ æˆ‘å†™ä¸æ¥ï¼Œè¯·æ“ä½œç³»ç»Ÿå¸®å¿™å’¯ï¼ï¼‰

```
ld -g -m elf_i386 -o test test.o
```

> ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤å‘ŠçŸ¥çš„æ˜¯è°ƒç”¨é“¾æ¥å™¨è¿æ¥æ–‡ä»¶ï¼š
>
> -gï¼šé“¾æ¥æ—¶ç»§ç»­ä¿ç•™è¿æ¥è°ƒè¯•ä¿¡æ¯
>
> -m: æŒ‰ç…§x86å¹³å°çš„æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œè¿æ¥çš„æ˜¯x86 32ä½æ–‡ä»¶
>
> -o: ç•¥

â€‹	ç°åœ¨ï¼Œæ‚¨çš„æ–‡ä»¶å¤¹ä¸‹ä¼šæœ‰testæ±‡ç¼–æ–‡ä»¶ã€‚æ‰§è¡Œå®ƒï¼š

```
charliechen@Charliechen:~/demo/demo5$ ./hello 
Hello, Assembly!
```

â€‹	å•Šå“ˆï¼æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼æ­å–œä½ ï¼Œä½ å­¦ä¼šäº†ã€‚ã€‚ã€‚å¥½å§ï¼Œè¿˜è¿œç€ï¼Œä½†æ˜¯è‡³å°‘æ‚¨ç°åœ¨æ˜¯ä¸€ä¸ªæ±‡ç¼–ç¨‹åºå‘˜æ–°æ‰‹äº†ï¼

â€‹	è¿™ä»½æ–‡ä»¶çš„å«ä¹‰å¦‚ä½•ï¼Œåˆ°åº•åšäº†ä»€ä¹ˆï¼Œè¯·å¬ä¸‹å›åˆ†è§£ï¼